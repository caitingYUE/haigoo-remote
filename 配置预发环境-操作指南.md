# 预发环境配置 - 立即操作指南

## 🎯 当前状态

✅ **代码已部署** - 所有预发环境支持代码已推送到 `develop` 分支

⏳ **等待配置** - 需要在Vercel Dashboard中配置环境变量

---

## 📋 立即执行的步骤（5分钟）

### 步骤1：登录Vercel

访问：https://vercel.com/dashboard

找到项目：`Haigoo_assistant` 或 `haigoo-remote`

---

### 步骤2：配置环境变量

进入：**Settings** → **Environment Variables**

#### 添加第一个变量：

```
变量名：ENABLE_AUTO_TRANSLATION
值：true
环境：☑️ Preview  ☑️ Development  (不要勾选Production)
```

**点击 "Save"**

#### 添加第二个变量：

```
变量名：CRON_SECRET
值：haigoo-preview-secret-2024  (可以自定义)
环境：☑️ Preview  ☑️ Development
```

**点击 "Save"**

---

### 步骤3：重新部署

#### 方式A：Vercel Dashboard手动部署（推荐）

1. 点击顶部导航的 **"Deployments"**
2. 找到最新的 **develop** 分支的部署记录
3. 点击右侧的 **"..."** 菜单
4. 选择 **"Redeploy"**
5. 等待1-2分钟部署完成

#### 方式B：Git推送触发（备选）

已经推送了代码，Vercel应该会自动触发新的部署。
查看 **Deployments** 页面确认是否有新的部署正在进行。

---

### 步骤4：验证配置

#### 4.1 获取预发环境URL

在 **Deployments** 页面，找到 `develop` 分支的最新部署，点击进去，复制 **Domain** URL

例如：
```
https://haigoo-git-develop-caitingyue.vercel.app
```

#### 4.2 访问健康检查API

在浏览器中访问（替换为你的实际URL）：
```
https://你的域名.vercel.app/api/health
```

#### 4.3 检查关键字段

查看返回的JSON，确认：

```json
{
  "environment": {
    "name": "Preview",        ✅ 必须是 "Preview"
    "isPreview": true         ✅ 必须是 true
  },
  "features": {
    "autoTranslation": true,  ✅ 必须是 true
    "cronSecret": true        ✅ 必须是 true
  },
  "recommendations": [],      ✅ 必须为空数组
  "summary": "Environment: Preview | Translation: ✅ | Storage: ..."
}
```

---

### 步骤5：测试功能

#### 5.1 测试后端翻译

1. 访问管理后台：`https://你的域名/admin_team`
2. 登录后，进入 **职位数据** → **处理后数据** 标签
3. 应该能看到 **"翻译数据"** 按钮
4. 点击按钮，观察是否成功翻译

#### 5.2 测试前台展示

1. 访问前台首页：`https://你的域名/`
2. 查看 **推荐页面** 和 **全部岗位** 页面
3. 确认岗位信息显示为中文

---

## ✅ 成功标志

如果看到以下现象，说明预发环境配置成功：

- ✅ `/api/health` 显示 `"autoTranslation": true`
- ✅ 管理后台有"翻译数据"按钮
- ✅ 点击翻译按钮成功执行，显示统计信息
- ✅ 前台页面显示中文翻译的岗位信息
- ✅ 控制台无严重错误

---

## 🐛 如果遇到问题

### 情况1：`autoTranslation` 仍为 `false`

**检查清单**：
- [ ] 在Vercel环境变量中是否勾选了 **Preview** 环境？
- [ ] 变量值是否为字符串 `"true"`（不是布尔值）？
- [ ] 是否已重新部署？（环境变量修改后必须重新部署）

---

### 情况2：前台仍显示英文

**解决步骤**：

1. 确认 `/api/health` 显示翻译功能已启用
2. 手动触发一次翻译：
   - 访问管理后台
   - 点击"翻译数据"按钮
   - 等待翻译完成
3. 刷新前台页面（硬刷新：Cmd+Shift+R）

---

### 情况3：找不到"翻译数据"按钮

**可能原因**：
- 未登录管理后台
- 浏览器缓存
- 前端代码未正确部署

**解决**：
1. 清空浏览器缓存
2. 硬刷新页面
3. 检查控制台是否有JavaScript错误

---

## 📊 配置前后对比

### 配置前：
```
❌ Preview环境后端API无法工作
❌ 翻译功能失效
❌ 管理后台无"翻译数据"按钮
❌ 前台显示英文数据
❌ 控制台显示"存储适配器未初始化"等错误
```

### 配置后：
```
✅ Preview环境后端API正常运行
✅ 翻译功能正常工作
✅ 管理后台显示"翻译数据"按钮
✅ 前台显示中文翻译数据
✅ 数据来自后端API（非实时RSS）
```

---

## 🔗 相关文档链接

需要更多帮助？查看详细文档：

1. **5分钟快速配置**: [VERCEL_PREVIEW_CONFIG.md](./VERCEL_PREVIEW_CONFIG.md)
2. **完整配置指南**: [PREVIEW_ENVIRONMENT_SETUP.md](./PREVIEW_ENVIRONMENT_SETUP.md)
3. **快速诊断脚本**: [QUICK_ENV_CHECK.md](./QUICK_ENV_CHECK.md)
4. **双环境部署策略**: [DEPLOYMENT_STRATEGY.md](./DEPLOYMENT_STRATEGY.md)

---

## 💡 额外建议（可选）

### 配置数据存储（推荐）

为了让预发环境更接近生产环境，建议配置独立的数据存储：

**方式A：Vercel KV（推荐）**
```
1. Vercel Dashboard → Storage → Create Database → KV
2. 名称：haigoo-preview-kv
3. 创建后会自动生成环境变量并绑定到Preview环境
```

**方式B：Upstash Redis**
```
1. 访问 upstash.com 创建免费Redis实例
2. 在Vercel环境变量中添加：
   REDIS_URL = redis://...
   环境：☑️ Preview ☑️ Development
```

---

## 📞 需要帮助？

如果完成以上步骤后仍有问题，提供以下信息：

1. `/api/health` 的完整JSON响应
2. Vercel环境变量配置截图（可隐藏敏感值）
3. 浏览器控制台的错误信息
4. 预发环境的具体URL

---

**预计完成时间**: 5-10分钟  
**难度**: ⭐⭐☆☆☆ (简单)  
**最后更新**: 2025-11-12

