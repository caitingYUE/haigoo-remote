---
alwaysApply: true
---
# 整体功能开发规则
- 尽量重后端，轻前端
- 前端只负责传递过滤参数、展示数据、处理用户交互等
- 后端通过数据库sql语句，实现联表、筛选、分页等逻辑

# 核心业务逻辑保护规范
- **严禁擅自修改核心流程**：包括但不限于【数据审核状态】（如默认是否通过）、【数据可见性】、【支付/会员权限】等。任何涉及这些字段默认值或处理流程的变更，必须先明确告知用户并获得确认。
- **禁止“隐式”业务变更**：严禁在修复Bug、优化性能或开发其他功能时，顺带修改核心业务逻辑（例如：为了方便测试而将新数据默认设为已审核）。
- **关键状态变更需显式注释**：如果确实经过确认需要修改核心状态逻辑，必须在代码中添加详细注释，说明修改人、日期、原因以及影响范围。

# 数据安全与重构规范
- **变量/常量移除检查**：在重构代码（尤其是移除或重命名顶层变量/常量）时，**必须**全局搜索该变量名，确保所有引用都已更新。禁止遗留未定义的变量引用。
- **Lint 检查强制执行**：修改核心工具类文件（如 `server-utils/dal/*.js`）后，**必须**运行 Lint 检查 (`npm run lint`)，确保没有语法错误或引用错误。
- **数据库错误显性化**：数据库连接失败或配置缺失时，**必须抛出明确的错误**，严禁静默失败或返回空数据（如 `null`/`[]`），以免前端误判为“数据被清空”。
- **禁止静默兜底**：如果核心服务（如数据库、第三方API）不可用，应直接报错，让系统感知异常，而不是通过返回空值或 Mock 数据来掩盖问题。

# 后端代码修改规范
## 代码位置
- Next.js结构
- 主要在/api目录下，进一步的会有 /lib/api-handlers、/lib/cron-handlers、/lib/services、/server-utils目录
## 数据库操作
- 表结构定义在 /server-utils/dal/neon-ddl.sql 中
    - 不要直接修改已有内容，比如要修改表结构，需要在该文件中继续新增对应的语句（比如，ALTER TABLE ...）
    - 业务需要，新增表结构时，需要在该文件中新增对应的建表语句，注释中记录日期、表的简介
    - 业务需要，修改表结构时，需要在该文件中新增对应的修改语句，注释中记录日期、修改的原因
    - 业务需要，删除表结构时，需要在该文件中新增对应的删除语句，注释中记录日期、删除的原因
    - 当前业务，暂时不需要建立索引
- 所有数据库底层操作都封装在 /server-utils/dal/neon-helper.js 中，服务层调用这些函数进行数据库操作
    - 服务层仅仅调用进行增删改查的SQL操作，不要直接写建表/删除表/修改表结构的语句，这些应该在 /server-utils/dal/neon-ddl.sql 中定义，由人工在数据库后台执行
## 后端代码开发
- 关键的环节多使用console.log打印日志（如，step1、step2...），方便排查问题
## Mock 数据规范
- **严禁使用 Mock 数据或功能**：在任何场景下（包括开发、测试、生产），都不得使用 Mock 数据。如果服务不可用或发生错误，必须直接报错，而不是回退到 Mock 数据。错误就是错误，必须暴露出来以便修复。

# 前端代码修改规范
- 前端主要负责数据的获取和展示，不要做过多的复杂操作
    - 不要过度使用缓存，类似分页、搜索等能力，应该在服务端实现，而不是前端拉取全部数据然后缓存之后再做操作。

# 白名单规范
白名单主要用来方便用户测试、内测配置，严禁随便通过给企业、职位加白名单，严禁为了短暂解决问题、投机取巧而加白名单。禁止选择短视方案。

# 发布规范
每次需求变更、bug修复、功能新增，都需要先自测，自测2次以上无误再发布。自测完成以后记得清除测试文件、过程文档。

# Git提交规范
- 优化/修改完成后，必须记得推送到git远程仓库。
- 这是一个必须一直记住、不能遗忘的步骤。

# 兜底规范
严禁通过【强制兜底】这样的操作来解决bug，必须要从根源上找到问题原因，而不是动不动采用兜底方案来临时修复问题。

# 权限规范
数据库增删改查操作，请贴出sql代码，提示人工前往数据库操作
用户权限（管理后台/会员等）修改，请提示人工前往后台操作
