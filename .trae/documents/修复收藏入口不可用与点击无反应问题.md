## 根因假设
- UI未渲染：详情页头部工具栏未包含心形按钮（部署未同步/代码被外层覆盖/指针事件被阻断）。
- 事件未绑定：`JobDetailModal` 未收到 `onSave/isSaved`，或按钮在组件外导致不会执行、TS构建曾报未定义。
- 请求前置判断拦截：`toggleSaveJob` 读取不到 token（`useAuth().token` 为空），直接返回；Network因此没有任何收藏请求。
- 样式遮挡：工具栏或其他层使用 `pointer-events:none`、z-index 导致点击被吞。

## 核查与修复步骤
### 1. 详情页渲染与事件绑定
- 在 `JobDetailModal` 工具栏内添加心形按钮（Bookmark），按钮始终可见。
- 显式将 `onSave` 与 `isSaved` 作为 props 传入，并在按钮 `onClick` 中调用 `onSave(job.id)`；`aria-pressed` 取自 `isSaved`。
- 在 `JobsPage`：
  - 列表卡片向 `JobCard` 传入 `onSave` 与 `isSaved`。
  - 打开详情弹窗时向 `JobDetailModal` 传入同样的 `onSave/isSaved`，保持状态一致。
- 在按钮与 `toggleSaveJob` 中加入轻量日志（`console.log('[favorite] jobId', jobId)`）便于验证点击是否触发。

### 2. 请求发起与认证令牌
- 统一使用 `POST /api/user-profile?action=favorites_add|favorites_remove&jobId=<id>`，同时在 body 传 `{ jobId }`，避免 DELETE 不解析 body。
- Token 获取策略：`useAuth().token || localStorage('haigoo_auth_token') || cookie('haigoo_auth_token')`，保证已登录用户能取到令牌。
- 失败回滚：请求失败时将本地高亮状态回滚，并在控制台输出错误信息；成功后刷新收藏集合。

### 3. 后端端点健壮性（已具备且再强化）
- `api/user-profile`：
  - `favorites`：返回收藏 ids 与联动状态（有效中/已失效/已下架）。
  - `favorites_add/remove`：从 query/body 读取 `jobId`，优先 Upstash REST（SMEMBERS/SADD/SREM），回退 Redis TCP/Vercel KV。
  - 响应包含 `success:true/false` 与错误信息，便于前端日志定位。

### 4. UI遮挡与交互
- 确认工具栏容器未使用 `pointer-events:none`，按钮具备 `pointer-events:auto`。
- 提升工具栏 `z-index` 以免被内容层覆盖；保持按钮可点击区域充足。

### 5. 验证与部署
- 列表页：点击卡片心形 → Network 出现 `favorites_add`，再点出现 `favorites_remove`。
- 详情页：点击头部心形 → 同样请求发起；弹窗关闭后列表高亮同步。
- 个人中心“我的收藏”：展示收藏卡片；当岗位不在数据库或已过期 → 灰显并标“已失效”。
- 预发环境完成端到端自测后，再次确认日志和 UI 状态。

## 交付
- 完成上述修复后推送到 `develop`（预发），并提供端到端验证截图和 Network 请求截图（含状态码与响应体）。