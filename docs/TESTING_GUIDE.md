# 用户认证系统测试指南

本指南帮助你快速测试新实现的用户认证系统功能。

---

## 🎯 测试清单

### ✅ 1. UI 优化验证

**测试步骤：**
1. 访问网站首页
2. 点击右上角用户下拉菜单（如果已登录）

**预期结果：**
- ✅ 下拉菜单中的选项**只显示文字，不显示图标**
- ✅ 菜单项包括：个人资料、简历优化、申请记录、AI洞察、设置
- ✅ 底部有红色的"退出登录"选项

---

### ✅ 2. 用户注册测试

**测试步骤：**
1. 访问 `https://haigooremote.com/register`
2. 填写测试邮箱（例如：`test@example.com`）
3. 设置密码（至少8位，包含字母和数字）
4. 可选：自定义用户名（不填则随机生成）
5. 点击"注册"按钮

**预期结果：**
- ✅ 注册成功后自动登录
- ✅ 页面跳转到首页 `/`
- ✅ 右上角显示用户头像和用户名
- ✅ 用户头像是随机生成的卡通头像
- ✅ 如果配置了SMTP，会收到验证邮件

**测试失败场景：**
- ❌ 密码少于8位 → 提示"密码至少需要8位"
- ❌ 密码没有字母或数字 → 提示"密码必须包含字母和数字"
- ❌ 邮箱已被注册 → 提示"该邮箱已被注册"
- ❌ 邮箱格式错误 → 提示"邮箱格式无效"

---

### ✅ 3. 用户登录测试

**测试步骤：**
1. 先退出登录（如果已登录）
2. 访问 `https://haigoo.vercel.app/login`
3. 输入已注册的邮箱和密码
4. 点击"登录"按钮

**预期结果：**
- ✅ 登录成功后跳转到首页
- ✅ 右上角显示用户信息
- ✅ 刷新页面后仍然保持登录状态（localStorage持久化）

**测试失败场景：**
- ❌ 邮箱或密码错误 → 提示"邮箱或密码错误"
- ❌ 邮箱未注册 → 提示"邮箱或密码错误"

---

### ✅ 4. 路由守卫测试

**测试步骤（未登录状态）：**
1. 确保已退出登录
2. 尝试直接访问以下页面：
   - `/profile` - 个人资料页
   - `/resume` - 简历优化页
   - `/admin` - 管理后台
   - `/admin/data` - 数据管理
   - `/job/123/apply` - 职位申请页

**预期结果：**
- ✅ 所有页面都自动跳转到 `/login`
- ✅ 登录成功后自动跳转回原页面

**测试步骤（已登录状态）：**
1. 登录后访问上述受保护页面

**预期结果：**
- ✅ 可以正常访问所有页面

---

### ✅ 5. 用户菜单功能测试

**测试步骤：**
1. 登录后点击右上角用户头像
2. 查看下拉菜单内容
3. 点击各个菜单项

**预期结果：**
- ✅ 显示用户头像（随机生成或Google头像）
- ✅ 显示用户名
- ✅ 显示邮箱或职位（如果有）
- ✅ 菜单项点击后正常跳转
- ✅ 点击"退出登录"后：
  - 跳转到登录页
  - localStorage中的token被清除
  - 右上角变为"登录/注册"按钮

---

### ✅ 6. 移动端测试

**测试步骤：**
1. 使用浏览器开发者工具切换到移动端视图
2. 点击右上角汉堡菜单
3. 查看移动端导航菜单

**预期结果（未登录）：**
- ✅ 底部显示"登录"和"注册"按钮

**预期结果（已登录）：**
- ✅ 显示用户头像和用户名
- ✅ 显示用户菜单选项（无图标，只有文字）
- ✅ 显示"退出登录"选项

---

### ✅ 7. 邮箱验证测试（需配置SMTP）

**测试步骤：**
1. 注册新账户
2. 查收验证邮件
3. 点击邮件中的验证链接

**预期结果：**
- ✅ 收到带有验证链接的邮件
- ✅ 邮件样式美观，包含Haigoo品牌元素
- ✅ 点击链接后跳转到验证页面
- ✅ 验证成功后用户状态更新为"已验证"

**注意：**
- 如果未配置SMTP，验证邮件不会发送，但不影响其他功能

---

### ✅ 8. Google登录测试（需配置GOOGLE_CLIENT_ID）

**测试步骤：**
1. 访问登录或注册页面
2. 点击"使用 Google 登录"按钮

**预期结果（已配置）：**
- ✅ 弹出Google登录窗口
- ✅ 授权后自动登录或注册
- ✅ 使用Google头像和用户名

**预期结果（未配置）：**
- ⚠️ 提示"Google 登录功能开发中"或"Google OAuth未配置"

---

### ✅ 9. 持久化测试

**测试步骤：**
1. 登录账户
2. 刷新页面（F5）
3. 关闭浏览器窗口并重新打开
4. 访问网站

**预期结果：**
- ✅ 刷新页面后仍然保持登录状态
- ✅ 关闭浏览器后重新打开仍然保持登录（30天内）
- ✅ Token过期后自动跳转到登录页

---

### ✅ 10. Redis/KV存储验证

**测试步骤：**

#### 方法1：通过API响应头检查

1. 打开浏览器开发者工具 → Network
2. 注册或登录
3. 查看 `/api/auth/register` 或 `/api/auth/login` 请求的响应头

**预期结果：**
- ✅ 响应头包含 `X-Diag-Redis-Configured: true`（如果配置了Redis）
- ✅ 或 `X-Diag-KV-Configured: true`（如果配置了Vercel KV）

#### 方法2：通过Redis CLI检查

```bash
# 连接到 Redis
redis-cli -u $REDIS_URL

# 查看所有用户key
KEYS haigoo:user:*

# 查看特定用户
GET haigoo:user:test@example.com

# 查看用户ID映射
GET haigoo:userId:user_xxx
```

**预期结果：**
- ✅ 可以看到用户数据存储在Redis中
- ✅ 数据格式为JSON字符串
- ✅ 包含所有用户字段（id, email, username, avatar等）

---

## 🚨 常见问题排查

### 问题1：登录后刷新页面变成未登录状态

**排查步骤：**
1. 打开浏览器开发者工具 → Application → Local Storage
2. 查看是否有 `haigoo_auth_token` 和 `haigoo_user` 键

**可能原因：**
- localStorage被禁用或清除
- Token格式错误
- JWT验证失败

**解决方案：**
- 清除localStorage后重新登录
- 检查浏览器控制台是否有错误

---

### 问题2：注册后显示"保存简历失败"

**排查步骤：**
1. 打开浏览器控制台查看错误信息
2. 检查Network标签中的API请求状态

**可能原因：**
- Redis/KV未正确配置
- 环境变量缺失

**解决方案：**
- 在Vercel Dashboard中检查环境变量
- 访问 `/api/health` 查看存储状态

---

### 问题3：邮箱验证邮件未收到

**排查步骤：**
1. 检查垃圾邮件文件夹
2. 查看服务器日志

**可能原因：**
- SMTP未配置
- 邮箱地址无效
- SMTP密码错误

**解决方案：**
- 配置正确的SMTP环境变量
- 使用Gmail应用专用密码

---

### 问题4：Google登录无法使用

**排查步骤：**
1. 检查是否配置了 `GOOGLE_CLIENT_ID`
2. 查看浏览器控制台错误

**可能原因：**
- Google OAuth未配置
- 前端未集成Google SDK

**解决方案：**
- 按照 `AUTH_SYSTEM_README.md` 配置Google OAuth
- 目前前端只有UI，需要进一步集成Google SDK

---

## ✨ 测试成功标准

完成以上所有测试后，如果满足以下条件，则认证系统功能正常：

- [x] UI已优化（菜单无图标）
- [x] 用户可以成功注册
- [x] 用户可以成功登录
- [x] 登录状态持久化（刷新页面不丢失）
- [x] 路由守卫正常工作（未登录无法访问受保护页面）
- [x] 用户菜单显示正确信息
- [x] 退出登录功能正常
- [x] 移动端UI正常
- [x] 数据存储在Redis/KV中（生产环境）

---

## 📊 测试报告模板

完成测试后，可以使用以下模板记录结果：

```
# 用户认证系统测试报告

测试时间：2025-11-07
测试环境：生产环境（haigoo.vercel.app）
测试人员：[你的名字]

## 测试结果

1. UI优化：✅ / ❌
2. 用户注册：✅ / ❌
3. 用户登录：✅ / ❌
4. 路由守卫：✅ / ❌
5. 用户菜单：✅ / ❌
6. 移动端：✅ / ❌
7. 邮箱验证：✅ / ❌ / N/A
8. Google登录：✅ / ❌ / N/A
9. 持久化：✅ / ❌
10. Redis存储：✅ / ❌

## 发现的问题

1. [问题描述]
2. [问题描述]

## 建议

1. [建议内容]
2. [建议内容]
```

---

## 🎉 测试完成！

如果所有测试都通过，恭喜！你的用户认证系统已经完全可用。

如果遇到问题，请查看 `AUTH_SYSTEM_README.md` 中的故障排查部分，或参考浏览器控制台的错误信息。