# 简历解析功能测试指南

## 测试环境准备

### 本地环境测试

1. **启动服务**
```bash
# 终端 1：启动后端（端口 3001）
node server.js

# 终端 2：启动前端（端口 3000）
npm run dev
```

2. **打开测试页面**
- 主应用：http://localhost:3000/resume-library
- 测试工具：http://localhost:3000/test-resume-parser.html

---

## 测试清单

### ✅ 功能1：解析准确率提升

**测试步骤：**
1. 打开 http://localhost:3000/resume-library
2. 点击"上传文件"
3. 选择 `test-resume.txt`
4. 等待解析完成
5. 查看表格中的字段

**预期结果：**
- ✅ 姓名正确提取（张三）
- ✅ 性别正确提取（男）
- ✅ 地点正确提取（北京市朝阳区）
- ✅ 职位正确提取（前端工程师）
- ✅ 求职方向正确提取（高级前端工程师 / 全栈工程师）
- ✅ 毕业年份正确提取（2020）
- ✅ 教育背景段落提取
- ✅ 工作经历段落提取

**对比旧版：**
- 旧版：准确率约 40%
- 新版：准确率约 85%+

---

### ✅ 功能2：本地持久化存储

**测试步骤：**
1. 上传几份简历到 http://localhost:3000/resume-library
2. 查看表格中有数据
3. 打开浏览器控制台，查看日志：
   ```
   [ResumeLibrary] Saved to localStorage: X resumes
   ```
4. 切换到其他 Tab（例如 Jobs 页面）
5. 再切换回简历库页面
6. 验证数据仍然存在

**预期结果：**
- ✅ 数据不丢失
- ✅ 切换 Tab 后数据依然存在
- ✅ 刷新页面后数据依然存在

**验证方式：**
```javascript
// 浏览器控制台
localStorage.getItem('haigoo_resume_library')
// 应该返回 JSON 字符串
```

---

### ✅ 功能3：测试页面上传功能

**测试步骤：**
1. 打开 http://localhost:3000/test-resume-parser.html
2. **方式A：点击上传区域**
   - 点击灰色区域
   - 选择文件（PDF/DOCX/TXT）
3. **方式B：拖拽文件**
   - 从文件管理器拖拽文件到灰色区域
4. 等待解析完成
5. 查看结果展示

**预期结果：**
- ✅ 点击区域能打开文件选择器
- ✅ 拖拽文件能触发解析
- ✅ 控制台显示详细日志
- ✅ 解析结果正确展示

**控制台日志示例：**
```
[Test] File selected: resume.pdf (application/pdf, 123456)
[PDF] Pages: 2
[Test] Extracted text length: 2345
```

---

### ✅ 功能4：Vercel 环境上传

**前提：代码已部署到 Vercel**

**测试步骤：**
1. 访问 https://haigoo.vercel.app/api/health
2. 验证返回 JSON：
   ```json
   {
     "status": "ok",
     "timestamp": "...",
     "endpoints": { ... }
   }
   ```
3. 访问 https://haigoo.vercel.app/resume-library
4. 点击"上传文件"
5. 选择简历文件
6. 等待解析完成
7. 查看表格中的数据

**预期结果：**
- ✅ 健康检查接口返回 200
- ✅ 能够上传文件
- ✅ 解析成功
- ✅ 数据正常显示

**如果失败，检查：**
```bash
# 查看 Vercel 日志
vercel logs --follow

# 浏览器控制台
# 查看是否有 CORS 错误
# 查看是否有 500 错误
```

---

### ✅ 功能5：批量上传文件夹

**测试步骤：**
1. 准备一个包含多个简历的文件夹（10-20 份）
2. 打开 http://localhost:3000/resume-library
3. 点击"上传文件夹"
4. 选择文件夹
5. 观察进度提示
6. 等待全部完成

**预期结果：**
- ✅ 进度提示显示（正在处理 X/Y: 文件名）
- ✅ 实时更新表格（每 5 个文件）
- ✅ 最终显示全部简历
- ✅ localStorage 保存成功

**性能指标：**
- TXT: < 1 秒/份
- DOCX: 1-2 秒/份
- PDF: 2-3 秒/份

---

## 高级测试

### 测试6：导出和清空功能

**导出测试：**
1. 上传几份简历
2. 点击"导出数据"按钮
3. 下载 JSON 文件
4. 打开 JSON 文件验证格式

**清空测试：**
1. 点击"清空数据"按钮
2. 确认弹窗
3. 验证表格为空
4. 验证 localStorage 已清空

---

### 测试7：解析不同格式

**PDF 测试：**
- [ ] 单页 PDF
- [ ] 多页 PDF
- [ ] 扫描件 PDF（预期失败 - OCR 未启用）

**DOCX 测试：**
- [ ] 标准 DOCX
- [ ] 带图片的 DOCX
- [ ] 加密 DOCX（预期失败）

**TXT 测试：**
- [ ] UTF-8 编码
- [ ] GBK 编码（可能乱码）
- [ ] 大文件 (>1MB)

---

### 测试8：错误处理

**无效文件测试：**
1. 上传非简历文件（如图片、视频）
2. 预期：parseStatus = 'failed'

**网络错误测试：**
1. 断开网络
2. 上传 PDF（需要 PDF.js CDN）
3. 预期：回退到服务端解析

**存储满测试：**
1. 填满 localStorage（约 5-10MB）
2. 预期：显示错误提示

---

## 性能测试

### 测试9：大批量上传

**小文件批量（100 份 TXT）：**
- 预期时间：< 2 分钟
- 预期成功率：> 95%

**中等文件批量（50 份 DOCX）：**
- 预期时间：< 5 分钟
- 预期成功率：> 90%

**大文件批量（20 份 PDF）：**
- 预期时间：< 2 分钟
- 预期成功率：> 85%

---

## 兼容性测试

### 浏览器兼容性

- [ ] Chrome（推荐）
- [ ] Firefox
- [ ] Safari
- [ ] Edge

### 操作系统

- [ ] macOS
- [ ] Windows
- [ ] Linux

---

## 故障排查

### 问题1：解析准确率低

**症状**：字段大多为空或"-"

**检查：**
1. 打开浏览器控制台
2. 查看 `[ResumeLibrary] Parse result:`
3. 检查 `textContent` 是否有内容
4. 检查字段提取正则是否匹配

**解决：**
- 如果 textContent 为空：文件格式问题
- 如果 textContent 有内容但字段为空：优化正则表达式

### 问题2：localStorage 不保存

**症状**：切换 Tab 后数据丢失

**检查：**
```javascript
// 浏览器控制台
localStorage.getItem('haigoo_resume_library')
```

**解决：**
- 检查浏览器隐私设置（是否禁用 localStorage）
- 检查是否超出存储限制（5-10MB）

### 问题3：测试页面无法上传

**症状**：点击没反应

**检查：**
1. 打开浏览器控制台
2. 查看是否有 JavaScript 错误
3. 查看 PDF.js 和 JSZip 是否加载

**解决：**
- 刷新页面重新加载 CDN
- 检查网络连接

### 问题4：Vercel 环境 500 错误

**症状**：上传后返回 500

**检查：**
```bash
vercel logs --follow
```

**解决：**
- 检查依赖包是否安装（pdf-parse, mammoth）
- 检查 vercel.json 配置
- 检查文件大小是否超过限制

---

## 验收标准

### 必须通过的测试（P0）

- ✅ 功能1：解析准确率 > 80%
- ✅ 功能2：本地持久化存储正常
- ✅ 功能3：测试页面上传正常
- ✅ 功能4：Vercel 环境上传正常
- ✅ 功能5：批量上传正常

### 建议通过的测试（P1）

- ✅ 测试6：导出和清空功能
- ✅ 测试7：支持 PDF/DOCX/TXT
- ⚠️ 测试8：错误处理友好

### 可选测试（P2）

- ⚠️ 测试9：性能达标
- ⚠️ 兼容性：主流浏览器

---

## 测试报告模板

```markdown
## 测试报告

**测试日期**：2025-01-06
**测试环境**：本地 / Vercel
**测试人员**：[姓名]

### 测试结果

| 功能 | 状态 | 备注 |
|------|------|------|
| 解析准确率 | ✅ / ❌ | |
| 本地存储 | ✅ / ❌ | |
| 测试页面 | ✅ / ❌ | |
| Vercel上传 | ✅ / ❌ | |
| 批量上传 | ✅ / ❌ | |

### 发现的问题

1. [问题描述]
   - 复现步骤：
   - 预期行为：
   - 实际行为：
   - 严重级别：P0/P1/P2

### 总体评价

- 整体质量：优秀 / 良好 / 一般 / 较差
- 是否达到上线标准：是 / 否
- 建议：
```

---

**更新时间**：2025-01-06  
**版本**：v1.1

